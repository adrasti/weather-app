<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <base href=".">
</head>
<body>
    <div class="page">
        <div class="text"></div>
        <div class="main">
            <div class="cont">
                <div class="maps">
                    <div id="map"></div>
                </div>
                <div class="weather">
                    <div class="temp">
                        <p id = "tempnum"></p>
                        <p id="state"></p>
                    </div>
                    <div id = "sunr">
                        <p>—</p>
                        <h3>sunrise</h3>
                    </div>
                    <div id = "suns">
                        <p>—</p>
                        <h3>sunset</h3>
                    </div>
                    <div id="wind">
                        <p>—</p>
                        <h3>wind</h3>
                    </div>
                    <div id="flslike">
                        <p>—</p>
                        <h3>feels like</h3>
                    </div>
                    <div id="pres">
                        <p>—</p>
                        <h3>pressure</h3>
                    </div>
                    <div id="humid">
                        <p>—</p>
                        <h3>humidity</h3>
                    </div>
                    <div id="tzone">
                        <p>—</p>
                        <h3>time zone</h3>
                    </div>
                    <div id="vbility">
                        <p>—</p>
                        <h3>visibility</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="https://api-maps.yandex.ru/2.1/?apikey=d2fcfcfc-0a1f-4563-b55d-8386a2084304&lang=en_RU"></script>
    <script>
        ymaps.ready(init);
        function init(){
            // Создание карты.
        myMap = new ymaps.Map("map", {
        center: [55.7558, 37.6173],
        zoom: 2
        }, {
        balloonMaxWidth: 200,
        searchControlProvider: 'yandex#search'
        });

        myMap.options.set('dragCursor', 'pointer');
        // Обработка события, возникающего при щелчке
        // левой кнопкой мыши в любой точке карты.
        // При возникновении такого события откроем балун.
        myMap.events.add('click', function (e) {
        if (!myMap.balloon.isOpen()) {
            var coords = e.get('coords');
            myMap.balloon.open(coords, {
                contentHeader:'Событие!',
                contentBody:'<p>Кто-то щелкнул по карте.</p>' +
                    '<p>Координаты ' + [
                    coords[0].toPrecision(6),
                    coords[1].toPrecision(6)
                    ].join(', ') + '</p>',
                contentFooter:'<sup>Щелкните еще раз</sup>'
            });
            getW(coords[1], coords[0]);
        }
        else {
            myMap.balloon.close();
        }
        });

        // Скрываем хинт при открытии балуна.
        myMap.events.add('balloonopen', function (e) {
        myMap.hint.close();
        });
        } //key c1ae969295473bf23abb9854d63dc1ee

        async function getW (lon, lat){
            const ie = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=c1ae969295473bf23abb9854d63dc1ee`, {mode: 'cors'});
            const j = await ie.json()
            const tit = document.querySelector(".text");
            let place = ''
            if(j.name){
                place += j.name;
            } else {
                place += "Unknown";
            }
            if(j.sys.country){
                let ctr = await fetch(`https://restcountries.com/v3.1/alpha/${j.sys.country.toLowerCase()}`, {mode: 'cors'});
                ctr = await ctr.json();
                place = place + ', ' + ctr[0].name.common;
            } 
            tit.textContent = place;
            document.querySelector("#tempnum").textContent = String((Number(j.main.temp) - 273.15).toFixed(1)) + "°";
            document.querySelector("#state").textContent = j.weather[0].description;

            let zone;
            if(Number(j.timezone) >= 0){
                zone = 'GMT+' + String((Number(j.timezone) / 3600).toFixed(0));
            } else {
                zone = 'GMT' + String((Number(j.timezone) / 3600).toFixed(0));
            }



            document.querySelector("#sunr p").textContent = convertTime(j.sys.sunrise, j.timezone);
            document.querySelector("#suns p").textContent = convertTime(j.sys.sunset, j.timezone);
            document.querySelector("#wind p").textContent = String(j.wind.speed) + " meter/sec";
            document.querySelector("#flslike p").textContent = String((Number(j.main.feels_like) - 273.15).toPrecision(3)) + "°";
            document.querySelector("#pres p").textContent = String((Number(j.main.pressure) * 0.02953).toFixed(1)) + " inHg"
            document.querySelector("#humid p").textContent = String(j.main.humidity) + "%";
            document.querySelector("#tzone p").textContent = zone;
            document.querySelector("#vbility p").textContent = String((Number(j.visibility) / 1000).toFixed(1)) + " km";
        };
        function convertTime(unixTime, tZone){
            var myDate = new Date( (unixTime + tZone - 10800)*1000);
            return myDate.toString().slice(16, 24);
        }

    </script>
</body>
</html> 